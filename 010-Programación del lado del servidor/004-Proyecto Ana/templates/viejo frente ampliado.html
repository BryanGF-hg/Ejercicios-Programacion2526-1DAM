<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>compilador.jocarsa.com</title>
    <style>
      :root {
        --bg: #f3f4f6;
        --panel: #ffffff;
        --border: #d4d4d8;
        --border-soft: #e4e4e7;
        --accent: #16a34a;
        --accent-soft: rgba(22, 163, 74, 0.1);
        --text: #111827;
        --text-muted: #6b7280;
        --terminal-bg: #111827;
        --terminal-text: #e5e7eb;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 55%);
        color: var(--text);
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .app {
        width: 100%;
        max-width: 1100px;
        padding: 24px;
      }

      .app-shell {
        background: var(--panel);
        border-radius: 18px;
        border: 1px solid var(--border);
        box-shadow: 0 20px 50px rgba(15, 23, 42, 0.08);
        padding: 20px 22px 18px;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 18px;
      }

      h1 {
        font-size: 20px;
        margin: 0;
        font-weight: 600;
        letter-spacing: 0.03em;
      }

      .subtitle {
        font-size: 12px;
        color: var(--text-muted);
      }

      .brand-pill {
        font-size: 11px;
        padding: 4px 10px;
        border-radius: 999px;
        background: var(--accent-soft);
        color: var(--accent);
        border: 1px solid rgba(22, 163, 74, 0.25);
      }

      .layout {
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 16px;
        margin-bottom: 14px;
      }

      .panel {
        background: #ffffff;
        border-radius: 14px;
        border: 1px solid var(--border-soft);
        display: flex;
        flex-direction: column;
        min-height: 260px;
      }

      .panel-header {
        padding: 8px 12px;
        border-bottom: 1px solid var(--border-soft);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .panel-title {
        font-size: 13px;
        font-weight: 500;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--text-muted);
      }

      .panel-badge {
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 999px;
        background: #f3f4f6;
        color: var(--text-muted);
      }

      .panel-body {
        padding: 10px 10px 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        height: 100%;
      }

      /* Editor de código */
      #editor {
        flex: 1;
        width: 100%;
        border: none;
        resize: vertical;
        border-radius: 10px;
        padding: 10px 11px;
        background: #f9fafb;
        color: var(--text);
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular,
          Menlo, Monaco, Consolas, "Liberation Mono", "Courier New",
          monospace;
        font-size: 13px;
        line-height: 1.4;
        outline: none;
        box-shadow: inset 0 0 0 1px #e5e7eb;
      }

      #editor:focus {
        box-shadow: inset 0 0 0 1px var(--accent);
      }

      .hint {
        font-size: 11px;
        color: var(--text-muted);
        display: flex;
        justify-content: space-between;
        gap: 8px;
      }

      .hint kbd {
        background: #e5e7eb;
        padding: 1px 4px;
        border-radius: 4px;
        border: 1px solid #d4d4d8;
        font-size: 10px;
        font-family: inherit;
      }

      /* Terminal */
      .terminal {
        display: flex;
        flex-direction: column;
        gap: 6px;
        height: 100%;
      }

      #terminal-log {
        flex: 1;
        margin: 0;
        padding: 10px 11px;
        background: var(--terminal-bg);
        color: var(--terminal-text);
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular,
          Menlo, Monaco, Consolas, "Liberation Mono", "Courier New",
          monospace;
        font-size: 13px;
        line-height: 1.5;
        border-radius: 10px;
        white-space: pre-wrap;
        overflow-y: auto;
      }

      .terminal-footer {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .terminal-input-row {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .prompt-label {
        font-family: "JetBrains Mono", ui-monospace;
        font-size: 13px;
        color: var(--text-muted);
      }

      #terminal-input {
        flex: 1;
        border-radius: 999px;
        border: 1px solid var(--border-soft);
        padding: 6px 10px;
        font-size: 12px;
        font-family: "JetBrains Mono", ui-monospace;
        outline: none;
      }

      #terminal-input:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.35);
      }

      .terminal-hint {
        font-size: 11px;
        color: var(--text-muted);
        display: flex;
        justify-content: space-between;
        gap: 8px;
      }

      .status-text {
        font-size: 11px;
        color: var(--text-muted);
      }

      .status-text span {
        color: var(--accent);
      }

      /* Barra inferior */
      .footer-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        margin-top: 8px;
      }

      .btn-main {
        padding: 8px 18px;
        border-radius: 999px;
        border: none;
        background: linear-gradient(135deg, #16a34a, #22c55e);
        color: white;
        font-weight: 500;
        font-size: 13px;
        letter-spacing: 0.07em;
        text-transform: uppercase;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 10px 24px rgba(34, 197, 94, 0.25);
      }

      .btn-main:active {
        transform: translateY(1px);
        box-shadow: 0 6px 14px rgba(34, 197, 94, 0.25);
      }

      .btn-main-icon {
        font-size: 15px;
      }

      .footer-info {
        font-size: 11px;
        color: var(--text-muted);
        text-align: right;
      }

      .footer-info span {
        color: var(--accent);
      }

      @media (max-width: 900px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="app-shell">
        <header>
          <div>
            <h1>compilador.jocarsa.com</h1>
            <div class="subtitle">
              Editor y terminal para ejecutar pequeños programas en Python
            </div>
          </div>
          <div class="brand-pill">JOCARSA · Python sandbox</div>
        </header>

        <main>
          <section class="layout">
            <!-- Panel editor -->
            <div class="panel">
              <div class="panel-header">
                <div class="panel-title">Editor</div>
                <div class="panel-badge">Python 3</div>
              </div>
              <div class="panel-body">
                <textarea id="editor" spellcheck="false">
nombre = input("¿Cómo te llamas? ")
edad = int(input("¿Cuántos años tienes? "))

print("Hola,", nombre)
print("El año que viene tendrás", edad + 1, "años.")</textarea>
                <div class="hint">
                  <div>Escribe tu programa aquí (multilínea).</div>
                  <div><kbd>Ctrl</kbd> + <kbd>Enter</kbd> para ejecutar</div>
                </div>
              </div>
            </div>

            <!-- Panel terminal -->
            <div class="panel">
              <div class="panel-header">
                <div class="panel-title">Terminal</div>
                <div class="panel-badge">STDIN · STDOUT · STDERR</div>
              </div>
              <div class="panel-body">
                <div class="terminal">
                  <pre id="terminal-log">$ compilador.jocarsa.com listo.
# La salida y las entradas aparecerán aquí.</pre>

                  <div class="terminal-footer">
                    <div class="terminal-input-row">
                      <span class="prompt-label">&gt;</span>
                      <input
                        id="terminal-input"
                        type="text"
                        placeholder="Escribe una línea de entrada y pulsa Enter…"
                      />
                    </div>
                    <div class="terminal-hint">
                      <div>
                        Cada Enter añade una línea a stdin (para <code>input()</code>).
                      </div>
                      <div class="status-text" id="status-text">
                        Estado: <span>inactivo</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <div class="footer-bar">
            <button id="run" class="btn-main">
              <span class="btn-main-icon">▶</span>
              Ejecutar programa
            </button>
            <div class="footer-info">
              Las líneas que introduzcas en la consola se usarán como
              <span>stdin</span> en orden para las llamadas a
              <code>input()</code>.
            </div>
          </div>
        </main>
      </div>
    </div>

    <script>
      const editor = document.querySelector("#editor");
      const terminalLog = document.querySelector("#terminal-log");
      const terminalInput = document.querySelector("#terminal-input");
      const statusText = document.querySelector("#status-text");
      const runButton = document.querySelector("#run");

      // Buffer de líneas de stdin
      const stdinLines = [];

      function setStatus(text) {
        statusText.innerHTML = 'Estado: <span>' + text + "</span>";
      }

      function resetForRun() {
        // Limpieza del log para cada ejecución
        terminalLog.textContent = "$ python programa.py\n";
      }

      function ejecutar() {
        const codigo = editor.value;
        const inputs = stdinLines.join("\n");

        resetForRun();
        setStatus("ejecutando…");

        fetch("/api", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            code: codigo,
            inputs: inputs,
          }),
        })
          .then((response) =>
            response.text().then((texto) => {
              if (!response.ok) {
                throw new Error(texto);
              }
              return texto;
            })
          )
          .then((salida) => {
            terminalLog.textContent += (salida || "OK") + "\n";
            setStatus("ejecución completada");
          })
          .catch((err) => {
            terminalLog.textContent += "\n[ERROR]\n" + err.message;
            setStatus("error de ejecución");
          })
          .finally(() => {
            // Tras ejecutar, puedes vaciar stdinLines si quieres
            // para obligar a volver a teclear las entradas.
            // Si prefieres mantenerlas entre ejecuciones, comenta la línea siguiente:
            stdinLines.length = 0;
          });
      }

      // Añadir línea de stdin con Enter en la consola
      terminalInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          e.preventDefault();
          const valor = terminalInput.value;
          if (valor.trim() === "") {
            terminalInput.value = "";
            return;
          }
          stdinLines.push(valor);
          // Opcional: mostrar la línea en la parte baja del log como eco previo
          // (el programa luego imprimirá también entradas y prompts).
          // Si no quieres este eco previo, comenta la línea siguiente:
          terminalLog.textContent += "> " + valor + "\n";
          terminalInput.value = "";
        }
      });

      // Ejecutar con el botón
      runButton.addEventListener("click", ejecutar);

      // Ejecutar con Ctrl+Enter en cualquier parte
      document.addEventListener("keydown", function (e) {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
          e.preventDefault();
          ejecutar();
        }
      });
    </script>
  </body>
</html>
010-mejoras.py
–
⧉
×
from flask import Flask, render_template, request, jsonify
import subprocess
import threading
import queue
import uuid
import os
import tempfile

app = Flask(__name__)

# Almacenar sesiones de procesos
sessions = {}

class PythonSession:
    def __init__(self, code: str):
        # Guardamos el código en un archivo temporal
        fd, path = tempfile.mkstemp(suffix=".py", prefix="compilador_")
        os.write(fd, code.encode("utf-8"))
        os.close(fd)

        self.path = path
        self.proc = subprocess.Popen(
            ["python3", self.path],
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
            text=True,
            bufsize=1,  # line-buffered
        )
        self.queue = queue.Queue()
        self.alive = True

        # Hilo que lee stdout + stderr y los mete en la cola
        self.thread = threading.Thread(target=self._reader_thread, daemon=True)
        self.thread.start()

    def _reader_thread(self):
        try:
            for line in self.proc.stdout:
                self.queue.put(line)
            # cuando stdout se cierra, leemos también stderr restante
            err = self.proc.stderr.read()
            if err:
                self.queue.put(err)
        finally:
            self.proc.wait()
            self.alive = False
            # limpiar archivo temporal
            try:
                os.remove(self.path)
            except OSError:
                pass

    def write(self, data: str):
        if not self.alive:
            return
        try:
            self.proc.stdin.write(data + "\n")
            self.proc.stdin.flush()
        except Exception:
            self.alive = False

    def read_all(self) -> str:
        chunks = []
        while not self.queue.empty():
            try:
                chunks.append(self.queue.get_nowait())
            except queue.Empty:
                break
        return "".join(chunks)

    def is_alive(self) -> bool:
        return self.alive and self.proc.poll() is None


@app.route("/")
def inicio():
    return render_template("frente.html")


@app.route("/api/start", methods=["POST"])
def api_start():
    data = request.get_json(force=True)
    code = data.get("code", "")

    session_id = str(uuid.uuid4())
    sessions[session_id] = PythonSession(code)

    return jsonify({"session_id": session_id})


@app.route("/api/write", methods=["POST"])
def api_write():
    data = request.get_json(force=True)
    session_id = data.get("session_id")
    line = data.get("line", "")

    sess = sessions.get(session_id)
    if not sess:
        return jsonify({"error": "Sesión no encontrada"}), 404

    sess.write(line)
    return jsonify({"ok": True})


@app.route("/api/read", methods=["GET"])
def api_read():
    session_id = request.args.get("session_id")
    sess = sessions.get(session_id)
    if not sess:
        return jsonify({"error": "Sesión no encontrada"}), 404

    output = sess.read_all()
    alive = sess.is_alive()

    # Si el proceso ha terminado y no queda nada que leer, limpiar la sesión
    if not alive and not output:
        sessions.pop(session_id, None)

    return jsonify({"output": output, "alive": alive})


if __name__ == "__main__":
    app.run(debug=True)
frentemasampliado.html
–
⧉
×

